<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="ind_cpp.js"></script>
    <style>
        .component {
            position: absolute;
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <script>
        let moduleInstance = null;

        function initializeComponents(screenWidth) {
            if (!moduleInstance) {
                createModule().then(Module => {
                    moduleInstance = Module;
                    updateComponents(screenWidth);
                });
            } else {
                updateComponents(screenWidth);
            }
        }

        function updateComponents(screenWidth) {
            const components = moduleInstance.getComponents(screenWidth);

            // 删除现有组件
            document.querySelectorAll('.component').forEach(e => e.remove());

            for (let i = 0; i < components.size(); i++) {
                const div = document.createElement('div');
                const component = components.get(i);
                div.className = 'component';
                div.style.left = component.x + 'px';
                div.style.top = component.y + 'px';
                div.style.width = component.w + 'px';
                div.style.height = component.h + 'px';
                div.style.visibility = component.v ? 'visible' : 'hidden';
                document.body.appendChild(div);
            }
        }

        // 获取初始屏幕宽度并初始化组件
        initializeComponents(window.innerWidth);

        // 添加事件监听器，在屏幕宽度变化时实时更新组件
        window.addEventListener('resize', () => {
            initializeComponents(window.innerWidth);
        });
    </script>
</body>

</html>